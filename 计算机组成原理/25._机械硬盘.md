# 机械硬盘

## 结构

![image](https://github.com/ingangi/blog/blob/master/img/hdd_struct.jpg)

### 盘面(Disk Platter)

- 实际存储数据的盘片，表面有一层磁性涂层用于保存数据；
- 中间有一个转轴，由电机控制，让盘面旋转；
- 转速RPM，是指每分钟盘面的旋转圈数；
- 一块硬盘由很多个盘面平行堆叠而成；
- **磁道**：每个盘面由很多同心圆组成，形成一圈圈的磁道；
- **扇区**：磁道划分为一个个扇区；
- **柱面**：上下盘面相同位置的扇区叠加形成柱面；

![image](https://github.com/ingangi/blog/blob/master/img/hdd_cylinder.jpg)

### 磁头(Drive Head)

- 负责从盘面**读取**数据；
- 每个盘面正反面都有磁头；

### 悬臂(Actutor Arm)

- 连着磁头，负责去**定位**磁道(Track)；

## 性能

### 读取数据步骤

1. 旋转盘面到某个位置，让悬臂可以定位到一定的扇区区间；
2. 移动悬臂到特定磁道、特定扇区，然后磁头落下读取；

### IOPS分析

从读取步骤可见，时间主要分2块：

1. **平均延时**：旋转盘面的时间，以7200rpm为例，平均延时是4.17ms；
2. **平均寻道时间**：悬臂定位扇区的时间。HDD硬盘一般4-10ms；

因此7200rpm的HDD硬盘的IOPS大约为：

```
max: 1s/8ms = 125 IOPS
min: 1s/14ms = 70 IOPS
```

### 软件优化策略

#### 顺序存放

将数据尽可能放在同一个柱面上，来达到**旋转一次盘面+一次寻道**的目的。

HDD硬盘顺序读写数据吞吐率：200MB/s左右。

#### Partial Stroking

通过格式化，让系统只能访问硬盘的一部分磁道，来**减少悬臂寻道的时间**。